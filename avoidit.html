<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta 6 - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            transition: background-color 0.3s, color 0.3s;
        }
        body.light-theme {
            background-color: #f1f5f9;
            color: #1e293b;
        }
        body.light-theme .sidebar {
            background-color: #e2e8f0;
            border-right: 2px solid #cbd5e1;
        }
        body.light-theme .sidebar-button {
            color: #475569;
        }
        body.light-theme .sidebar-button:hover, body.light-theme .sidebar-button.active {
            color: white;
            background-color: #0ea5e9;
        }
        body.light-theme .header {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        body.light-theme .header h1 {
            color: #0f172a;
        }
        body.light-theme .card {
            background-color: #ffffff;
            color: #334155;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        body.light-theme .card h3, body.light-theme .card h2 {
            color: #0f172a;
        }
        body.light-theme .card p {
            color: #475569;
        }
        body.light-theme .grid-container .card:hover {
            transform: translateY(-5px);
        }
        .main-container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 256px;
            background-color: #1e293b;
            padding: 1.5rem;
            border-right: 2px solid #334155;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            flex-shrink: 0;
            transition: background-color 0.3s, border-right 0.3s;
        }
        .sidebar-button {
            width: 100%;
            text-align: left;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: #94a3b8;
            font-weight: 600;
            transition: all 0.2s;
        }
        .sidebar-button:hover, .sidebar-button.active {
            color: #e2e8f0;
            background-color: #0ea5e9;
        }
        .content-area {
            flex-grow: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }
        .card {
            background-color: #1e293b;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease-in-out, background-color 0.3s, color 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #334155;
            border: 1px solid #475569;
            color: #e2e8f0;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        .light-theme .form-input {
            background-color: #cbd5e1;
            border-color: #94a3b8;
            color: #1e293b;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="main-container">

        <aside class="sidebar">
            <div class="flex items-center gap-2">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSPUjmt_X_yRY2FhAHToeCDmsn-YbAchcD288349bDVnIk9B9tz8qgcmJg&s" alt="Delta 6 Logo" class="w-8 h-8">
                <h1 class="text-2xl font-bold">Delta</h1>
            </div>
            <nav class="flex flex-col gap-2" id="sidebar-nav">
                <button class="sidebar-button active" data-path="dashboard-overview">Dashboard</button>
                <div class="mt-4">
                    <button id="learn-toggle" class="sidebar-button flex items-center justify-between" data-path="learn-overview">
                        <h2 class="text-sm font-bold uppercase text-gray-400">Learn</h2>
                        <span id="learn-icon">▼</span>
                    </button>
                    <div id="learn-sub-menu" class="flex flex-col gap-2 pl-4 mt-2 hidden">
                        <button class="sidebar-button" data-path="xss">XSS Scanner</button>
                        <button class="sidebar-button" data-path="sql-injection">SQLi Scanner</button>
                        <button class="sidebar-button" data-path="open-redirect">Open Redirect</button>
                        <button class="sidebar-button" data-path="subdomain-finder">Subdomain Finder</button>
                        <button class="sidebar-button" data-path="assets-discovery">Asset Discovery</button>
                    </div>
                </div>
                <div class="mt-4">
                    <button class="sidebar-button" data-path="reports">Reports</button>
                </div>
                <div class="mt-4">
                    <button class="sidebar-button" data-path="settings">Settings</button>
                </div>
            </nav>
        </aside>

        <main class="content-area">
            <header class="header flex items-center justify-between mb-8 pb-4 border-b-2 border-slate-700">
                <h1 class="text-2xl font-semibold text-white" id="welcome-user">Welcome, Admin</h1>
                <button id="logout-button" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-xl transition-colors duration-200">
                    Logout
                </button>
            </header>

            <div id="dynamic-content">
                </div>
        </main>
    </div>
    
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 p-8 rounded-xl shadow-lg w-full max-w-sm">
            <h3 id="modal-title" class="text-xl font-bold mb-4 text-white"></h3>
            <p id="modal-message" class="text-gray-300 mb-6"></p>
            <button id="close-modal" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 rounded-xl">
                OK
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('loggedIn') === 'true';
            if (!isLoggedIn) {
                window.location.href = '/scanner/index.html'; // Also update here for unauthenticated users
                return;
            }

            const dynamicContent = document.getElementById('dynamic-content');
            const sidebarNav = document.getElementById('sidebar-nav');
            const logoutButton = document.getElementById('logout-button');
            const learnToggle = document.getElementById('learn-toggle');
            const learnSubMenu = document.getElementById('learn-sub-menu');
            const learnIcon = document.getElementById('learn-icon');
            const welcomeUser = document.getElementById('welcome-user');

            let currentUserName = localStorage.getItem('userName') || 'Admin';
            welcomeUser.textContent = `Welcome, ${currentUserName}`;

            function showMessage(title, message) {
                const modal = document.getElementById('message-modal');
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-message').textContent = message;
                modal.classList.remove('hidden');
            }

            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('message-modal').classList.add('hidden');
            });

            const pages = {
                'dashboard-overview': {
                    title: 'Dashboard Overview',
                    isDashboard: true
                },
                'learn-overview': {
                    title: 'Learn about Vulnerabilities',
                    description: 'Here you will find an extensive guide to common web vulnerabilities. Each section provides a detailed explanation of how a specific bug works, its potential impact, and crucial prevention techniques to help you build more secure applications. Select a bug from the "Learn" menu to begin your journey.'
                },
                'xss': {
                    title: 'XSS Scanner',
                    description: 'A tool for detecting Cross-Site Scripting vulnerabilities. XSS is a vulnerability that allows an attacker to inject malicious scripts into web pages viewed by other users. This can be used to steal user session cookies, redirect users, or perform other malicious actions.',
                    prevention: `
                        <h4 class="text-xl font-bold mt-6 mb-2 text-white">Prevention</h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li><b>Sanitize and escape</b> all untrusted data before inserting it into the HTML.</li>
                            <li>Set the <b>HttpOnly</b> flag on session cookies to prevent them from being accessed by client-side scripts.</li>
                            <li>Implement a strong <b>Content Security Policy (CSP)</b> to control which scripts can execute.</li>
                        </ul>
                    `,
                },
                'sql-injection': {
                    title: 'SQL Injection (SQLi) Scanner',
                    description: 'Test parameters for SQL injection flaws. SQL injection is a code injection technique in which malicious SQL statements are inserted into an entry field for execution. An attacker can use this to bypass authentication, retrieve data, or even modify the database.',
                    prevention: `
                        <h4 class="text-xl font-bold mt-6 mb-2 text-white">Prevention</h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li>Use <b>Prepared Statements</b> with parameterized queries. This separates the SQL command from the user-provided data.</li>
                            <li>Use <b>Stored Procedures</b>.</li>
                            <li>Validate and sanitize all user input.</li>
                            <li>Minimize database permissions for web applications.</li>
                        </ul>
                    `,
                },
                'open-redirect': {
                    title: 'Open Redirect',
                    description: 'A tool to identify and verify open redirect issues. This is a vulnerability where a web application allows an attacker to manipulate parameters and redirect users to a malicious website. This is often used in phishing campaigns.',
                    prevention: `
                        <h4 class="text-xl font-bold mt-6 mb-2 text-white">Prevention</h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li>Do not use untrusted input to build redirection URLs.</li>
                            <li>Use a whitelist of allowed domains or paths for all redirects.</li>
                            <li>Inform the user before redirecting them to an external site.</li>
                        </ul>
                    `,
                },
                'subdomain-finder': {
                    title: 'Subdomain Finder',
                    description: 'A tool for enumerating subdomains and hidden assets. This is a reconnaissance technique used to map out a target\'s attack surface and find other entry points.',
                    prevention: `
                        <h4 class="text-xl font-bold mt-6 mb-2 text-white">Prevention</h4>
                        <p class="text-gray-400 mt-2">
                            While finding subdomains is not a vulnerability in itself, it is a critical step in reconnaissance. To reduce your attack surface, ensure all unused subdomains are properly decommissioned. Always secure all subdomains with the same rigor as your main domain.
                        </p>
                    `,
                },
                'assets-discovery': {
                    title: 'Asset Discovery',
                    description: 'A tool for mapping application endpoints and directories. Attackers use this to identify potential vulnerabilities in older scripts or to find hidden assets not visible to the user.',
                    prevention: `
                        <h4 class="text-xl font-bold mt-6 mb-2 text-white">Prevention</h4>
                        <p class="text-gray-400 mt-2">
                            This is another reconnaissance technique. To mitigate risks, ensure that all assets are up-to-date and that there are no sensitive files or information accessible through direct links. Regularly audit your publicly available files.
                        </p>
                    `,
                },
                'reports': {
                    title: 'Reports',
                    description: 'Generate detailed vulnerability reports. This is a placeholder for a future feature to summarize scan findings and provide actionable insights.',
                    prevention: `
                        <h4 class="text-xl font-bold mt-6 mb-2 text-white">Status</h4>
                        <p class="text-gray-400 mt-2">
                            This feature is currently under development. Please check back later.
                        </p>
                    `,
                },
                'settings': {
                    title: 'Settings',
                    isSettings: true,
                    content: `
                        <div class="space-y-8">
                            <div>
                                <h3 class="text-2xl font-bold mb-4">Profile Settings</h3>
                                <form id="profile-form" class="space-y-4">
                                    <div>
                                        <label for="username" class="block text-sm font-medium">Update Display Name</label>
                                        <input type="text" id="username" value="${currentUserName}" class="form-input mt-1 block">
                                    </div>
                                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl">Save Changes</button>
                                </form>
                            </div>

                            <div>
                                <h3 class="text-2xl font-bold mb-4">Password Management</h3>
                                <form id="password-form" class="space-y-4">
                                    <div>
                                        <label for="current-password" class="block text-sm font-medium">Current Password</label>
                                        <input type="password" id="current-password" class="form-input mt-1 block">
                                    </div>
                                    <div>
                                        <label for="new-password" class="block text-sm font-medium">New Password</label>
                                        <input type="password" id="new-password" class="form-input mt-1 block">
                                    </div>
                                    <div>
                                        <label for="confirm-password" class="block text-sm font-medium">Confirm New Password</label>
                                        <input type="password" id="confirm-password" class="form-input mt-1 block">
                                    </div>
                                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl">Change Password</button>
                                </form>
                            </div>

                            <div>
                                <h3 class="text-2xl font-bold mb-4">Theme Settings</h3>
                                <button id="theme-toggle-button" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-xl">
                                    Toggle Dark/Light Theme
                                </button>
                            </div>
                        </div>
                    `,
                },
            };

            const dashboardCards = [
                { path: 'xss', title: 'XSS Scanner', description: 'Detect reflected and stored XSS vulnerabilities.' },
                { path: 'sql-injection', title: 'SQL Injection', description: 'Test parameters for SQL injection flaws.' },
                { path: 'open-redirect', title: 'Open Redirect', description: 'Identify and verify open redirect issues.' },
                { path: 'subdomain-finder', title: 'Subdomain Finder', description: 'Enumerate subdomains and hidden assets.' },
                { path: 'assets-discovery', title: 'Asset Discovery', description: 'Map application endpoints and directories.' },
            ];

            function renderContent(path) {
                const page = pages[path];
                if (!page) {
                    renderContent('dashboard-overview');
                    return;
                }
                
                if (['xss', 'sql-injection', 'open-redirect', 'subdomain-finder', 'assets-discovery'].includes(path)) {
                    learnSubMenu.classList.remove('hidden');
                    learnIcon.textContent = '▲';
                } else if (path !== 'learn-overview') {
                    learnSubMenu.classList.add('hidden');
                    learnIcon.textContent = '▼';
                }

                if (page.isDashboard) {
                    const cardsHtml = dashboardCards.map(card => `
                        <div class="card cursor-pointer" data-path="${card.path}">
                            <h3 class="text-lg font-semibold mb-2 text-white">${card.title}</h3>
                            <p class="text-sm text-gray-400">${card.description}</p>
                        </div>
                    `).join('');
                    dynamicContent.innerHTML = `
                        <h2 class="text-xl font-bold mb-6">Dashboard Overview</h2>
                        <div class="grid-container" id="dashboard-cards-container">
                            ${cardsHtml}
                        </div>
                    `;
                    document.querySelectorAll('#dashboard-cards-container .card').forEach(card => {
                        card.addEventListener('click', (e) => {
                            const newPath = e.currentTarget.dataset.path;
                            window.location.href = `/${newPath}/index.html`;
                        });
                    });
                } else if (page.isSettings) {
                    dynamicContent.innerHTML = `<div class="card">${page.content}</div>`;
                    
                    document.getElementById('profile-form').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const newName = document.getElementById('username').value;
                        if (newName.trim() !== '') {
                            showMessage('Success', 'Display name updated successfully!');
                        } else {
                            showMessage('Error', 'Display name cannot be empty.');
                        }
                    });

                    document.getElementById('password-form').addEventListener('submit', (e) => {
                        e.preventDefault();
                        showMessage('Success', 'Password changed successfully!');
                        document.getElementById('password-form').reset();
                    });

                    document.getElementById('theme-toggle-button').addEventListener('click', () => {
                        document.body.classList.toggle('light-theme');
                        localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
                    });
                } else {
                    dynamicContent.innerHTML = `
                        <div class="card">
                            <h2 class="text-3xl font-bold text-white mb-4">${page.title}</h2>
                            <p class="text-gray-400 mb-6">${page.description}</p>
                            ${page.prevention || ''}
                        </div>
                    `;
                }
            }

            function updateActiveSidebarButton(path) {
                document.querySelectorAll('.sidebar-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeBtn = document.querySelector(`[data-path="${path}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }

            learnToggle.addEventListener('click', () => {
                const isHidden = learnSubMenu.classList.toggle('hidden');
                learnIcon.textContent = isHidden ? '▼' : '▲';
                updateActiveSidebarButton('learn-overview');
                renderContent('learn-overview');
            });

            sidebarNav.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                if(button.id === 'learn-toggle') return;

                const path = button.dataset.path;
                updateActiveSidebarButton(path);
                renderContent(path);
            });

            logoutButton.addEventListener('click', () => {
                localStorage.removeItem('loggedIn');
                localStorage.removeItem('userName');
                localStorage.removeItem('theme');
                // *** THIS LINE IS NOW MODIFIED ***
                window.location.href = '/scanner/index.html';
            });

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
            }

            renderContent('dashboard-overview');
        });
    </script>
</body>
</html>
